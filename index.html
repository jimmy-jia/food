<!DOCTYPE html>
<html>
	<head>
		<title>foodseeker</title>
		<meta charset="utf-8">
		<link href='http://fonts.googleapis.com/css?family=Nunito' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="depend/sweet-alert.css">
		<link href="stylesheet.css" rel="stylesheet" type="text/css">
		<link rel="icon" href="favicon.ico">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src='https://cdn.firebase.com/js/client/1.1.1/firebase.js'></script>
		<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
		<script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/oauth.js"></script>
        <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/sha1.js"></script>
        <script src="depend/sweet-alert.min.js"></script>
        <script type="text/javascript">
        	function pgload() {
        		swal({
        			title: "Work In Progress!", 
        			text: "This is a site in progress, updates coming soon", 
        			type:"info",
        			confirmButtonColor: "#00bbef"
        		});
        	};
        	var auth = {
                consumerKey : "mY7J5hvTUPX7NTLRAZ7TVg",
                consumerSecret : "JkqVm7VWhUejIIVDLjHBQI2Pa_k",
                accessToken : "7sbA81Z0sHv7VCacqNQQI2sZGetyxVja",
                accessTokenSecret : "xW6Xj9-PVHyfqxJoHAGLajtkqjI",
                serviceProvider : {
                    signatureMethod : "HMAC-SHA1"
                }
            };
        </script>
	</head>
	<body>
		<div class="wrapper">
			<div class="top">
				<a href="index.html" id="logo">foodseeker</a>
				<ul class="nav">
					<li><a href="index.html">home</a></li>
					<li><a href="about.html">about</a></li>
					<li><a href="stores.html">stores</a></li>
				</ul>
			</div>
			<div class="center">
				<p class="title">Welcome to <span id="lobo">foodseeker</span></p>
				<p class="subtitle">Seeking food in Urbana-Champaign</p>
				<p class="help">No idea what to eat? Don't worry, we got you.</p>
				<form class="sbar" id ="submitform">
					<input type='text' id='Input' placeholder='What are you in the mood for?' onsubmit="return false">
					<input type='button' id='button' value="Send" onclick="getLocation()">
					<input type='button' id='button2' value="Send" onclick="search()">
				</form>
				<p id="errorshow"></p>
				<input type='button' id="autobutton" value="Manual Location Input?" onclick="manual()">
				<input type='button' id="geobutton" value="Return to Geolocation Input?" onclick="georeturn()">
				<p id="testing"></p>
				<script>
					var errorshow = document.getElementById('errorshow');
					var autobutton = document.getElementById('autobutton');
					var geobutton = document.getElementById('geobutton');
					var smethod = 0;
					var lat=0;
					var lon=0;
					var category;
					window.onload=pgload;
					function getLocation() {
						category=document.getElementById('Input').value;
						$(errorshow).fadeOut(400);
					    if (navigator.geolocation) {
					        navigator.geolocation.getCurrentPosition(showPosition, showError);
					    } else {
					        errorshow.innerHTML = "Geolocation is not supported by this browser.";
					    }
					}
					function showPosition(position) {
						$(errorshow).fadeIn(400);
					    errorshow.innerHTML = "Latitude: " + position.coords.latitude + 
					    "<br>Longitude: " + position.coords.longitude; 
					    smethod=1;
					    lat=position.coords.latitude;
					    lon=position.coords.longitude;
					    search();
					}
					function showError(error) {
					    switch(error.code) {
					        case error.PERMISSION_DENIED:
					            swal("Error", "User or browser denied the request for Geolocation. Please try again.", "error")
					            break;
					        case error.POSITION_UNAVAILABLE:
					            swal("Error", "Location information is unavailable.", "error")
					            break;
					        case error.TIMEOUT:
					            swal("Error", "The request to get user location timed out.", "error")
					            break;
					        case error.UNKNOWN_ERROR:
					            swal("Error", "An unknown error occurred.", "error")
					            break;
					    }
					    //errorshow.innerHTML = 
					    $(autobutton).fadeIn(400);
					    //$(errorshow).fadeIn(400);
					}
					function manual(){
						$(errorshow).fadeIn(400);
						errorshow.innerHTML="Manual Input Mode";
						
						var input_field = document.getElementById('Input');
						input_field.placeholder="Please enter your City and State.";
						input_field.value="";
						var but1 = document.getElementById('button');
						var but2 = document.getElementById('button2');
						$(but1).fadeOut(0);
						$(but2).fadeIn(0);
						autobutton.value="";
					}
					function search(){
						if (smethod==1){
							cll=[lat, lon];
						}
						else if (smethod==0){
							var loc=document.getElementById('Input').value;
						}
						var accessor={
							consumerSecret : auth.consumerSecret,
							tokenSecret : auth.accessTokenSecret
						};
						parameters=[];
						parameters.push(['term', category]);
						if (smethod==1){
							parameters.push(['cll', cll]);
						}
						else if (smethod==0){
							parameters.push(['location', loc]);
						}
			            //parameters.push(['callback', 'cb']);
            			parameters.push(['oauth_consumer_key', auth.consumerKey]);
            			parameters.push(['oauth_consumer_secret', auth.consumerSecret]);
            			parameters.push(['oauth_token', auth.accessToken]);
            			parameters.push(['oauth_signature_method', 'HMAC-SHA1']);

            			var message={
            				'action' : 'http://api.yelp.com/v2/search',
            				'method' : 'GET',
            				'parameters' : parameters
            			};

            			swal("Parameters", parameters);

            			OAuth.setTimestampAndNonce(message);
            			OAuth.SignatureMethod.sign(message, accessor);
            			var parameterMap = OAuth.getParameterMap(message.parameters);
            			console.log(parameterMap);
            			$.ajax({
            				'url' : message.action,
            				'data' : parameterMap,
            				'dataType' : 'jsonp',
            				'jsonpCallback' : 'cb',
            				'success' : function(data, textStats, XMLHttpRequest){
            					console.log(data);
            				}
            			});
					return 0;
					}
				</script>
			</div>
		</div>
	</body>
</html>